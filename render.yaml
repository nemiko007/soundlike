services:
  # --- バックエンドサービス (Go) ---
  - type: web
    name: backend
    env: docker
    plan: free
    region: singapore # 日本からアクセスしやすいリージョン（任意）
    # Dockerfileがある場所を指定
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    envVars:
      - key: PORT
        value: 8080
      # Firebaseキーのパス（RenderのSecret Files機能でこのパスに配置します）
      - key: GOOGLE_APPLICATION_CREDENTIALS
        value: /etc/secrets/firebase-service-account-key.json

  # --- フロントエンドサービス (Nginx) ---
  - type: static
    name: frontend
    plan: free
    region: singapore
    rootDir: frontend
    buildCommand: npm install && npm run build
    publishPath: dist
    routes:
      # APIリクエストをバックエンドへ転送 (Nginxのproxy_passの代わり)
      # バックエンドのパスに合わせて調整してください
      - source: /api/*
        destination: http://backend:8080/api/*
      # SPAのリダイレクト設定 (すべての不明なパスをindex.htmlへ)
      - source: /*
        destination: /index.html
    envVars:
      # フロントエンドのビルドに必要な環境変数を指定します
      # 変数名はプロジェクトのコード内で使用しているもの（.envなど）に合わせて変更してください
      - key: PUBLIC_FIREBASE_API_KEY
        sync: false
      - key: PUBLIC_FIREBASE_AUTH_DOMAIN
        sync: false
      - key: PUBLIC_FIREBASE_PROJECT_ID
        sync: false
      - key: PUBLIC_FIREBASE_STORAGE_BUCKET
        sync: false
      - key: PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        sync: false
      - key: PUBLIC_FIREBASE_APP_ID
        sync: false
      - key: PUBLIC_FIREBASE_MEASUREMENT_ID
        sync: false